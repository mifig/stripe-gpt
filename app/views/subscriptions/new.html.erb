<div class="mx-4 mt-3">
  <h1 class="mb-3">Subscribing to <strong><%= @plan.stripe_name.capitalize %> Plan</strong></h1>
  <h2><%= humanized_money_with_symbol(@plan.stripe_price) %> p/ <%= @plan.stripe_recurrance_interval %></h2>

  <div class="mt-3">
    <%# FORM FOR CUSTOM CARD: %>
    <%= form_with url: plan_subscriptions_path(@plan),
                  id: "subscription-form", 
                  data: { 
                    controller: "stripe",
                    stripe_publishable_key_value: Rails.configuration.stripe[:publishable_key],
                    action: "submit->stripe#createSubscription"
                  } do |f| %>
      <%= f.hidden_field :stripe_email, data: { stripe_target: "email" }, value: current_user.email %>
      <%= f.hidden_field :stripe_default_price, value: @plan.stripe_default_price_id %>

      <div class="form-group mb-3">
        <%= f.label "Credit Card", class: "form-label" %>
        <div id="card-element" class="form-control" data-stripe-target="cardElement"></div>
        <div id="card-errors" role="alert" data-stripe-target="cardErrors"></div>
      </div>
      <%= f.submit "Pay", class: "btn btn-primary" %>
    <% end %>
  </div>
</div>
